<mat-sidenav-container>
  <mat-sidenav
    mode="side"
    align="start"
    opened
  >
    <app-header-layout></app-header-layout>
    <mat-accordion
      class=""
      [multi]="true"
    >
      <mat-expansion-panel
        class="mat-elevation-z event-list"
        [expanded]="true"
      >
        <mat-expansion-panel-header
          class="main-header"
          [collapsedHeight]="'50px'"
          [expandedHeight]="'50px'"
        >
          <mat-panel-title>
            <strong class="text-uppercase">Event list</strong>
          </mat-panel-title>
          <mat-panel-description>
            <small *ngIf="days.length > 0 && days[0].length > 0">
              ({{days[days?.length-1][0]?.time_utc | date:' MMM dd':days[days?.length-1][0]?.timezone}} -
              {{(days[0])[0]?.time_utc | date:' dd yyyy':days[0][0]?.timezone}})
            </small>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <ng-template matExpansionPanelContent>

          <mat-accordion class="days">
            <mat-expansion-panel
              *ngFor="let day of days; let i = index"
              class="mat-elevation-z day"
              [expanded]="i === 0"
              hideToggle
            >
              <mat-expansion-panel-header
                [collapsedHeight]="'30px'"
                [expandedHeight]="'30px'"
              >
                <mat-panel-title>
                  {{day[0]?.time_utc | date:' MMM dd':day[i]?.timezone}} <small class="pl-1">
                    {{day[0]?.time_utc | date:'yyyy':day[i]?.timezone}}</small>
                </mat-panel-title>
                <mat-panel-description>
                  <div class="mr-auto"></div>
                  ({{day.length}} events)
                </mat-panel-description>
              </mat-expansion-panel-header>
              <mat-nav-list dense>
                <ng-container *ngFor="let event of day; let j = index;">
                  <a
                    mat-list-item
                    [routerLink]="['/v2/events', event.event_resource_id]"
                    [ngClass]="{
                      'active': event?.event_resource_id === currentEvent.event_resource_id,
                      'event-accepted-manual': ['preliminary', 'confirmed', 'reviewed', 'final', 'reported'].indexOf(event?.status) > -1 && event?.evaluation_mode === 'manual',
                      'event-accepted-automatic': ['preliminary', 'confirmed', 'reviewed', 'final', 'reported'].indexOf(event?.status) > -1 && event?.evaluation_mode === 'automatic',
                      'event-rejected-manual': ['rejected'].indexOf(event?.status) > -1 && event?.evaluation_mode === 'manual',
                      'event-rejected-automatic': ['rejected'].indexOf(event?.status) > -1 && event?.evaluation_mode === 'automatic'
                  }"
                  >
                    <mat-icon>
                      {{event.event_type | eventTypeIcon}}
                    </mat-icon>
                    <div class="px-3">
                      {{event.time_utc | date:'HH:mm:ss':event.timezone}}
                      <small>{{event.time_utc | date:'.SSS'}}</small>
                      <ng-container *ngIf="event?.magnitude !== -999">
                        ({{event?.magnitude | eventMagnitude}} {{event?.magnitude_type}})
                      </ng-container>
                    </div>
                    <div class="mr-auto"></div>
                    <button
                      class="chart-button"
                      mat-icon-button
                      matTooltip="Open chart"
                      (click)="openChart(event)"
                    >
                      <mat-icon>insert_chart_outlined</mat-icon>
                    </button>
                  </a>
                  <mat-divider *ngIf="j !== day?.length -1"></mat-divider>
                </ng-container>
              </mat-nav-list>
            </mat-expansion-panel>

          </mat-accordion>

        </ng-template>



      </mat-expansion-panel>

      <mat-expansion-panel
        [expanded]="true"
        class="mat-elevation-z event-detail"
      >
        <mat-expansion-panel-header
          class="main-header"
          [collapsedHeight]="'50px'"
          [expandedHeight]="'50px'"
        >
          <mat-panel-title>
            <strong class="text-uppercase">Event detail</strong>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <app-event-info [event]=currentEvent></app-event-info>

        <button
          mat-raised-button
          (click)="openDialog()"
        >Edit event</button>
      </mat-expansion-panel>
    </mat-accordion>


  </mat-sidenav>
  <mat-sidenav-content>
    <app-waveform-2
      *ngIf="true"
      [event]="currentEventChart"
    ></app-waveform-2>
  </mat-sidenav-content>

</mat-sidenav-container>
